<!--  
    ModAPI v2.0 - Fluent Design Styles
    Windows 11 Fluent Design override layer
    Loaded after Dictionary.xaml to override key visual styles
    -->

<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:Components="clr-namespace:ModAPI.Components">

    <!-- ===== Fluent Color Palette ===== -->
    <Color x:Key="FluentAccentColor">#0078D4</Color>
    <Color x:Key="FluentAccentLightColor">#429CE3</Color>
    <Color x:Key="FluentAccentDarkColor">#005A9E</Color>
    <Color x:Key="FluentBgColor">#1C1C1C</Color>
    <Color x:Key="FluentBgSecondaryColor">#2D2D2D</Color>
    <Color x:Key="FluentBgTertiaryColor">#383838</Color>
    <Color x:Key="FluentSurfaceColor">#2D2D2D</Color>
    <Color x:Key="FluentCardColor">#282828</Color>
    <Color x:Key="FluentBorderColor">#3D3D3D</Color>
    <Color x:Key="FluentTextPrimaryColor">#FFFFFF</Color>
    <Color x:Key="FluentTextSecondaryColor">#C5C5C5</Color>
    <Color x:Key="FluentTextTertiaryColor">#9A9A9A</Color>
    <Color x:Key="FluentDangerColor">#E81123</Color>
    <Color x:Key="FluentSuccessColor">#107C10</Color>
    <Color x:Key="FluentWarningColor">#FF8C00</Color>
    <Color x:Key="FluentTabBarColor">#1A1A1A</Color>

    <SolidColorBrush x:Key="FluentAccentBrush" Color="{StaticResource FluentAccentColor}" />
    <SolidColorBrush x:Key="FluentAccentLightBrush" Color="{StaticResource FluentAccentLightColor}" />
    <SolidColorBrush x:Key="FluentAccentDarkBrush" Color="{StaticResource FluentAccentDarkColor}" />
    <SolidColorBrush x:Key="FluentBgBrush" Color="{StaticResource FluentBgColor}" />
    <SolidColorBrush x:Key="FluentBgSecondaryBrush" Color="{StaticResource FluentBgSecondaryColor}" />
    <SolidColorBrush x:Key="FluentBgTertiaryBrush" Color="{StaticResource FluentBgTertiaryColor}" />
    <SolidColorBrush x:Key="FluentSurfaceBrush" Color="{StaticResource FluentSurfaceColor}" />
    <SolidColorBrush x:Key="FluentCardBrush" Color="{StaticResource FluentCardColor}" />
    <SolidColorBrush x:Key="FluentBorderBrush" Color="{StaticResource FluentBorderColor}" />
    <SolidColorBrush x:Key="FluentTextPrimaryBrush" Color="{StaticResource FluentTextPrimaryColor}" />
    <SolidColorBrush x:Key="FluentTextSecondaryBrush" Color="{StaticResource FluentTextSecondaryColor}" />
    <SolidColorBrush x:Key="FluentTextTertiaryBrush" Color="{StaticResource FluentTextTertiaryColor}" />
    <SolidColorBrush x:Key="FluentDangerBrush" Color="{StaticResource FluentDangerColor}" />
    <SolidColorBrush x:Key="FluentSuccessBrush" Color="{StaticResource FluentSuccessColor}" />
    <SolidColorBrush x:Key="FluentWarningBrush" Color="{StaticResource FluentWarningColor}" />
    <SolidColorBrush x:Key="FluentTabBarBrush" Color="{StaticResource FluentTabBarColor}" />

    <!-- ===== Fluent Typography ===== -->
    <FontFamily x:Key="BigFont">Segoe UI Semibold, Segoe UI</FontFamily>
    <FontFamily x:Key="NormalFont">Segoe UI</FontFamily>
    <FontFamily x:Key="FluentIconFont">Segoe MDL2 Assets</FontFamily>

    <!-- ===== Override: NormalLabel ===== -->
    <Style x:Key="NormalLabel" TargetType="{x:Type TextBlock}">
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
    </Style>

    <!-- ===== Override: WhiteLabel ===== -->
    <Style x:Key="WhiteLabel" TargetType="{x:Type TextBlock}" BasedOn="{StaticResource NormalLabel}">
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
    </Style>

    <!-- ===== Override: HeaderLabel ===== -->
    <Style x:Key="HeaderLabel" TargetType="{x:Type TextBlock}" BasedOn="{StaticResource NormalLabel}">
        <Setter Property="FontFamily" Value="{StaticResource BigFont}" />
        <Setter Property="FontSize" Value="16" />
    </Style>

    <!-- ===== Override: Window (Minimal - content handles layout) ===== -->
    <Style TargetType="{x:Type Window}" x:Key="Window">
        <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality" />
        <Setter Property="RenderOptions.ClearTypeHint" Value="Enabled" />
        <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        <Setter Property="TextOptions.TextFormattingMode" Value="Ideal" />
        <Setter Property="Background" Value="{StaticResource FluentBgBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="WindowStyle" Value="None" />
        <Setter Property="AllowsTransparency" Value="False" />
        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome GlassFrameThickness="0" CaptionHeight="48" ResizeBorderThickness="6" CornerRadius="0" UseAeroCaptionButtons="False" />
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Window}">
                    <Border Background="{TemplateBinding Background}" BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="1">
                        <AdornerDecorator>
                            <ContentPresenter />
                        </AdornerDecorator>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Fluent Caption Button ===== -->
    <Style x:Key="FluentCaptionButton" TargetType="{x:Type Button}">
        <Setter Property="Width" Value="46" />
        <Setter Property="Height" Value="36" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="FontFamily" Value="{StaticResource FluentIconFont}" />
        <Setter Property="FontSize" Value="10" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextSecondaryBrush}" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#1AFFFFFF" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#12FFFFFF" />
                            <Setter Property="Foreground" Value="{StaticResource FluentTextTertiaryBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Fluent Close Button (Red hover) ===== -->
    <Style x:Key="FluentCloseButton" TargetType="{x:Type Button}" BasedOn="{StaticResource FluentCaptionButton}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="{StaticResource FluentDangerBrush}" />
                            <Setter Property="Foreground" Value="White" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#CC1122" />
                            <Setter Property="Foreground" Value="#CCFFFFFF" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: Minimize/Maximize/Normalize Buttons ===== -->
    <Style TargetType="{x:Type Button}" x:Key="MinimizeButton" BasedOn="{StaticResource FluentCaptionButton}">
        <Setter Property="Content" Value="&#xE921;" />
    </Style>
    <Style TargetType="{x:Type Button}" x:Key="MaximizeButton" BasedOn="{StaticResource FluentCaptionButton}">
        <Setter Property="Content" Value="&#xE922;" />
    </Style>
    <Style TargetType="{x:Type Button}" x:Key="NormalizeButton" BasedOn="{StaticResource FluentCaptionButton}">
        <Setter Property="Content" Value="&#xE923;" />
    </Style>

    <!-- ===== Override: SubWindow (Fluent Dialog) ===== -->
    <Style TargetType="{x:Type Window}" x:Key="SubWindow">
        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome GlassFrameThickness="0" CaptionHeight="0" ResizeBorderThickness="0" CornerRadius="8" />
            </Setter.Value>
        </Setter>
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="AllowsTransparency" Value="True" />
        <Setter Property="WindowStyle" Value="None" />
        <Setter Property="ResizeMode" Value="NoResize" />
        <Setter Property="SizeToContent" Value="WidthAndHeight" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Window}">
                    <Border Background="{StaticResource FluentSurfaceBrush}" 
                            BorderBrush="{StaticResource FluentBorderBrush}" 
                            BorderThickness="1" CornerRadius="8" Margin="16">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="24" Opacity="0.6" ShadowDepth="4" Direction="270" />
                        </Border.Effect>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="48" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Background="Transparent" CornerRadius="8,8,0,0">
                                <Grid>
                                    <Rectangle x:Name="PART_Mover" Fill="Transparent" IsHitTestVisible="True" 
                                               HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Margin="0,0,40,0" />
                                    <TextBlock Margin="20,0,48,0" Text="{TemplateBinding Title}" 
                                               HorizontalAlignment="Left" Style="{StaticResource HeaderLabel}" VerticalAlignment="Center" />
                                    <Button x:Name="PART_Close" Width="32" Height="32" Margin="0,0,8,0"
                                            HorizontalAlignment="Right" VerticalAlignment="Center"
                                            Style="{StaticResource FluentCaptionButton}" Content="&#xE8BB;" />
                                </Grid>
                            </Border>
                            <Border Grid.Row="1" CornerRadius="0,0,8,8">
                                <ContentPresenter Margin="20,0,20,20" Content="{TemplateBinding Content}" />
                            </Border>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: SplashScreen ===== -->
    <Style TargetType="{x:Type Window}" x:Key="SplashScreen">
        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome GlassFrameThickness="-1" CaptionHeight="0" ResizeBorderThickness="0" />
            </Setter.Value>
        </Setter>
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="WindowStyle" Value="None" />
        <Setter Property="AllowsTransparency" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Window}">
                    <Border Background="#1E1E1E" CornerRadius="12" BorderBrush="#3D3D3D" BorderThickness="1">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="32" Opacity="0.5" ShadowDepth="0" />
                        </Border.Effect>
                        <AdornerDecorator>
                            <ContentPresenter Content="{TemplateBinding Content}" />
                        </AdornerDecorator>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ======================================================================== -->
    <!-- ===== PHASE 3: Top Tabs (Fluent Horizontal Navigation) ================ -->
    <!-- ======================================================================== -->

    <Style x:Key="TopTabs" TargetType="{x:Type Components:TabControlEx}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Components:TabControlEx}">
                    <Grid SnapsToDevicePixels="True">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="48" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Tab Strip -->
                        <Border Grid.Row="0" Background="{StaticResource FluentTabBarBrush}" BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="0,0,0,1">
                            <TabPanel x:Name="HeaderPanel" IsItemsHost="True" 
                                      Margin="12,0,0,0" Background="Transparent" 
                                      Panel.ZIndex="1" KeyboardNavigation.TabIndex="1"
                                      WindowChrome.IsHitTestVisibleInChrome="True" />
                        </Border>

                        <!-- Content Area -->
                        <Grid x:Name="PART_ItemsHolder" Grid.Row="1" 
                              SnapsToDevicePixels="True" 
                              HorizontalAlignment="Stretch" 
                              VerticalAlignment="Stretch" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== TopTab (Fluent Tab Item) ===== -->
    <Style x:Key="TopTab" TargetType="{x:Type Components:IconTabItem}">
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Height" Value="48" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextSecondaryBrush}" />
        <Setter Property="Padding" Value="16,0" />
        <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Components:IconTabItem}">
                    <Grid x:Name="Root" Background="Transparent" SnapsToDevicePixels="True"
                          WindowChrome.IsHitTestVisibleInChrome="True">
                        <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Image x:Name="TabIcon" 
                                       Width="16" Height="16" Margin="0,0,8,0"
                                       RenderOptions.BitmapScalingMode="HighQuality" 
                                       Opacity="0.7">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IsSelected}" Value="False">
                                                    <Setter Property="Source" Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IconSource}" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IsSelected}" Value="True">
                                                    <Setter Property="Source" Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=SelectedIconSource}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                <TextBlock x:Name="TabLabel" 
                                           Text="{TemplateBinding Label}" 
                                           VerticalAlignment="Center"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           Foreground="{TemplateBinding Foreground}" />
                            </StackPanel>
                        </Border>
                        <!-- Selection indicator -->
                        <Border x:Name="Indicator" Height="3" CornerRadius="1.5" 
                                VerticalAlignment="Bottom" Margin="16,0,16,0"
                                Background="Transparent" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#0AFFFFFF" />
                            <Setter TargetName="TabLabel" Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
                            <Setter TargetName="TabIcon" Property="Opacity" Value="0.9" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="TabLabel" Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
                            <Setter TargetName="TabLabel" Property="FontFamily" Value="{StaticResource BigFont}" />
                            <Setter TargetName="TabIcon" Property="Opacity" Value="1.0" />
                            <Setter TargetName="Indicator" Property="Background" Value="{StaticResource FluentAccentBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== IconItemTab (used inside TopTab headers in code-behind) ===== -->
    <Style x:Key="IconItemTab" TargetType="{x:Type ContentControl}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ContentControl}">
                    <ContentPresenter />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== PopupTabs (Inner Tab Control - Fluent) ===== -->
    <Style x:Key="PopupTabs" TargetType="{x:Type Components:TabControlEx}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Components:TabControlEx}">
                    <Grid SnapsToDevicePixels="True">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Background="Transparent" BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="0,0,0,1">
                            <TabPanel x:Name="HeaderPanel" IsItemsHost="True" 
                                      Margin="4,0,0,0" Background="Transparent" />
                        </Border>
                        <Grid x:Name="PART_ItemsHolder" Grid.Row="1" SnapsToDevicePixels="True" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== PopupTab (Inner Tab Item - Fluent) ===== -->
    <Style x:Key="PopupTab" TargetType="{x:Type Components:IconTabItem}">
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Height" Value="40" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextSecondaryBrush}" />
        <Setter Property="Padding" Value="12,0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Components:IconTabItem}">
                    <Grid x:Name="Root" Background="Transparent" SnapsToDevicePixels="True">
                        <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Image x:Name="TabIcon" 
                                       Width="14" Height="14" Margin="0,0,6,0"
                                       RenderOptions.BitmapScalingMode="HighQuality" Opacity="0.7">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IsSelected}" Value="False">
                                                    <Setter Property="Source" Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IconSource}" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=IsSelected}" Value="True">
                                                    <Setter Property="Source" Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Components:IconTabItem}}, Path=SelectedIconSource}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                <TextBlock x:Name="TabLabel" 
                                           Text="{TemplateBinding Label}" 
                                           VerticalAlignment="Center"
                                           FontSize="{TemplateBinding FontSize}"
                                           Foreground="{TemplateBinding Foreground}" />
                                <!-- Warning indicator -->
                                <Ellipse x:Name="Warning" Width="6" Height="6" Fill="{StaticResource FluentWarningBrush}" 
                                         Margin="4,0,0,0" VerticalAlignment="Center"
                                         Visibility="{Binding ShowWarning, RelativeSource={RelativeSource TemplatedParent}}" />
                            </StackPanel>
                        </Border>
                        <Border x:Name="Indicator" Height="2" CornerRadius="1" 
                                VerticalAlignment="Bottom" Margin="12,0,12,0" Background="Transparent" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#0AFFFFFF" />
                            <Setter TargetName="TabLabel" Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="TabLabel" Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
                            <Setter TargetName="TabLabel" Property="FontWeight" Value="SemiBold" />
                            <Setter TargetName="TabIcon" Property="Opacity" Value="1.0" />
                            <Setter TargetName="Indicator" Property="Background" Value="{StaticResource FluentAccentBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: PopupPanel (Section Panel with Title) ===== -->
    <Style TargetType="{x:Type Components:PopupPanel}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Components:PopupPanel}">
                    <Border Background="{StaticResource FluentCardBrush}" 
                            BorderBrush="{StaticResource FluentBorderBrush}" 
                            BorderThickness="1" CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <!-- Title -->
                            <Border x:Name="TitleBorder" Grid.Row="0" Padding="16,12,16,8" 
                                    BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="0,0,0,1">
                                <TextBlock Text="{TemplateBinding Title}" 
                                           Style="{StaticResource HeaderLabel}" FontSize="14" />
                            </Border>
                            <!-- Content -->
                            <ContentPresenter Grid.Row="1" Content="{TemplateBinding Content}" />
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: NormalButton (Fluent Button) ===== -->
    <Style TargetType="{x:Type Button}" x:Key="NormalButton">
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Height" Value="32" />
        <Setter Property="Padding" Value="12,5,12,6" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg" Background="{StaticResource FluentBgTertiaryBrush}" 
                            BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="1" 
                            CornerRadius="4" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#444444" />
                            <Setter TargetName="Bg" Property="BorderBrush" Value="#505050" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#333333" />
                            <Setter Property="Foreground" Value="{StaticResource FluentTextSecondaryBrush}" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Bg" Property="Background" Value="#1A1A1A" />
                            <Setter Property="Foreground" Value="{StaticResource FluentTextTertiaryBrush}" />
                            <Setter TargetName="Bg" Property="BorderBrush" Value="#2A2A2A" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Fluent Accent Button ===== -->
    <Style x:Key="AccentButton" TargetType="{x:Type Button}" BasedOn="{StaticResource NormalButton}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg" Background="{StaticResource FluentAccentBrush}" 
                            BorderBrush="{StaticResource FluentAccentBrush}" BorderThickness="1" 
                            CornerRadius="4" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="{StaticResource FluentAccentLightBrush}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="{StaticResource FluentAccentDarkBrush}" />
                            <Setter Property="Foreground" Value="#CCFFFFFF" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Bg" Property="Background" Value="#1A1A1A" />
                            <Setter Property="Foreground" Value="{StaticResource FluentTextTertiaryBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: CloseButton / DarkCloseButton ===== -->
    <Style TargetType="{x:Type Button}" x:Key="CloseButton">
        <Setter Property="Width" Value="20" />
        <Setter Property="Height" Value="20" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg" Background="Transparent" CornerRadius="4">
                        <TextBlock Text="&#xE8BB;" FontFamily="{StaticResource FluentIconFont}" FontSize="10" 
                                   Foreground="{StaticResource FluentTextSecondaryBrush}" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center" x:Name="Icon" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#33FFFFFF" />
                            <Setter TargetName="Icon" Property="Foreground" Value="White" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style TargetType="{x:Type Button}" x:Key="DarkCloseButton" BasedOn="{StaticResource CloseButton}" />

    <!-- ===== Override: PanelCenter (Fluent Card) ===== -->
    <Style TargetType="{x:Type ContentControl}" x:Key="PanelCenter">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ContentControl}">
                    <Border Background="{StaticResource FluentCardBrush}" 
                            BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="1" CornerRadius="6">
                        <ContentPresenter Margin="{TemplateBinding Padding}" />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: PanelTop / PanelBottom / PanelSplit / PanelButtons / TabBox ===== -->
    <Style TargetType="{x:Type ContentControl}" x:Key="PanelTop" BasedOn="{StaticResource PanelCenter}" />
    <Style TargetType="{x:Type ContentControl}" x:Key="PanelBottom" BasedOn="{StaticResource PanelCenter}" />
    <Style TargetType="{x:Type ContentControl}" x:Key="PanelSplit">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ContentControl}">
                    <Border Height="1" Background="{StaticResource FluentBorderBrush}" Margin="0,4" />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style TargetType="{x:Type ContentControl}" x:Key="PanelButtons">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ContentControl}">
                    <Border Background="Transparent" BorderBrush="{StaticResource FluentBorderBrush}" 
                            BorderThickness="0,1,0,0" Padding="4">
                        <ContentPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style TargetType="{x:Type ContentControl}" x:Key="TabBox" BasedOn="{StaticResource PanelCenter}" />

    <!-- ===== Override: RoundLabel ===== -->
    <Style TargetType="{x:Type ContentControl}" x:Key="RoundLabel">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ContentControl}">
                    <Border Background="{StaticResource FluentAccentBrush}" CornerRadius="14" Padding="12,4">
                        <ContentPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: ListItem ===== -->
    <Style x:Key="ListItem" TargetType="{x:Type ListBoxItem}">
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="12,8" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                    <Border x:Name="Bg" Background="Transparent" 
                            BorderThickness="3,0,0,0" BorderBrush="Transparent" 
                            Padding="{TemplateBinding Padding}" Margin="2" CornerRadius="4">
                        <ContentPresenter />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#15FFFFFF" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#20FFFFFF" />
                            <Setter TargetName="Bg" Property="BorderBrush" Value="{StaticResource FluentAccentBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: List (Fluent ListBox) ===== -->
    <Style x:Key="List" TargetType="{x:Type ListBox}">
        <Setter Property="Background" Value="{StaticResource FluentCardBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="2" />
        <Setter Property="ItemContainerStyle" Value="{StaticResource ListItem}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListBox}">
                    <Border Background="{TemplateBinding Background}" 
                            BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}" 
                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Override: ListScrollViewer ===== -->
    <Style x:Key="ListScrollViewer" TargetType="{x:Type ScrollViewer}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="VerticalScrollBarVisibility" Value="Auto" />
    </Style>

    <!-- ===== Override: ChromelessTextBox ===== -->
    <Style x:Key="ChromelessTextBox" TargetType="{x:Type TextBox}">
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Background" Value="{StaticResource FluentBgTertiaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CaretBrush" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="8,6" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <Border x:Name="Bg" Background="{TemplateBinding Background}" 
                            BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                            CornerRadius="4" Padding="{TemplateBinding Padding}">
                        <ScrollViewer x:Name="PART_ContentHost" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsFocused" Value="True">
                            <Setter TargetName="Bg" Property="BorderBrush" Value="{StaticResource FluentAccentBrush}" />
                            <Setter TargetName="Bg" Property="BorderThickness" Value="1,1,1,2" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="#404040" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Fluent Tooltip ===== -->
    <Style TargetType="{x:Type ToolTip}">
        <Setter Property="Background" Value="{StaticResource FluentSurfaceBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="10,6,10,8" />
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ToolTip}">
                    <Border Background="{TemplateBinding Background}" 
                            BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                            CornerRadius="4" Padding="{TemplateBinding Padding}">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="16" Opacity="0.4" ShadowDepth="2" Direction="270" />
                        </Border.Effect>
                        <ContentPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== Fluent ProgressBar ===== -->
    <Style x:Key="FluentProgressBar" TargetType="{x:Type ProgressBar}">
        <Setter Property="Height" Value="4" />
        <Setter Property="Background" Value="{StaticResource FluentBgTertiaryBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentAccentBrush}" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ProgressBar}">
                    <Grid>
                        <Border Background="{TemplateBinding Background}" CornerRadius="2" />
                        <Border x:Name="PART_Track" />
                        <Border x:Name="PART_Indicator" Background="{TemplateBinding Foreground}" CornerRadius="2" HorizontalAlignment="Left" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ===== TreeViewItem Override ===== -->
    <Style TargetType="{x:Type TreeViewItem}">
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="4,2" />
    </Style>



    <Style TargetType="{x:Type TextBox}">
        <Setter Property="Background" Value="{StaticResource FluentBgSecondaryBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="CaretBrush" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="4,3" />
        <Setter Property="BorderThickness" Value="1" />
    </Style>

    <!-- ===== ListView / GridView Theme Support ===== -->
    <Style TargetType="{x:Type ListView}">
        <Setter Property="Background" Value="{StaticResource FluentCardBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style TargetType="{x:Type ListViewItem}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="Padding" Value="4,2" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListViewItem}">
                    <Border x:Name="Bd" Background="{TemplateBinding Background}" 
                            BorderBrush="{StaticResource FluentBorderBrush}" BorderThickness="0,0,0,0.5"
                            Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                        <GridViewRowPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="#1AFFFFFF" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource FluentAccentBrush}" />
                            <Setter Property="Foreground" Value="White" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="FluentColumnHeaderGripper" TargetType="{x:Type Thumb}">
        <Setter Property="Width" Value="18" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Thumb}">
                    <Border Background="Transparent" Padding="0,0,0,0">
                        <Rectangle Width="1" HorizontalAlignment="Center" Fill="{StaticResource FluentBorderBrush}" />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="{x:Type GridViewColumnHeader}">
        <Setter Property="Background" Value="{StaticResource FluentBgTertiaryBrush}" />
        <Setter Property="Foreground" Value="{StaticResource FluentTextPrimaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource FluentBorderBrush}" />
        <Setter Property="BorderThickness" Value="0,0,1,1" />
        <Setter Property="Padding" Value="6,4" />
        <Setter Property="FontFamily" Value="{StaticResource NormalFont}" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type GridViewColumnHeader}">
                    <Grid>
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center" RecognizesAccessKey="True" />
                        </Border>
                        <Thumb x:Name="PART_HeaderGripper" HorizontalAlignment="Right" Margin="0,0,-9,0"
                               Style="{StaticResource FluentColumnHeaderGripper}" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="#2AFFFFFF" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource FluentAccentDarkBrush}" />
                        </Trigger>
                        <Trigger Property="Role" Value="Padding">
                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource FluentBgTertiaryBrush}" />
                            <Setter TargetName="Bd" Property="BorderThickness" Value="0" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="{x:Type GridSplitter}">
        <Setter Property="Background" Value="{StaticResource FluentBorderBrush}" />
    </Style>

</ResourceDictionary>
